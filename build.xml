<?xml version="1.0" encoding="UTF-8"?>

<project name="deploy" default="deploy:sync-files">

  <!-- ## Properties -->

  <property name="deploy.local.path"      value="${project.basedir}/docroot" />
  <property name="deploy.remote.host"     value="" />
  <property name="deploy.remote.path"     value="" />
  <property name="deploy.remote.port"     value="" />
  <property name="deploy.remote.username" value="" />

  <!-- ## Targets -->

  <target name="deploy:sync-files"
          description="Syncs files from local directory to remote server."
          hidden="true">
    <fail unless="deploy.local.path"
          message="Please provide a deploy.local.path property." />
    <fail unless="deploy.remote.host"
          message="Please provide a deploy.remote.host property." />
    <fail unless="deploy.remote.port"
          message="Please provide a deploy.remote.port property." />
    <fail unless="deploy.remote.path"
          message="Please provide a deploy.remote.path property." />
    <fail unless="deploy.remote.username"
          message="Please provide a deploy.remote.username property." />

    <property name="deploy.sync.options" value="-avz --force --delete --exclude-from '.deployignore' -e 'ssh -p ${deploy.remote.port}'" />
    <property name="deploy.sync.local"   value="${deploy.local.path}/" />
    <property name="deploy.sync.remote"  value="${deploy.remote.username}@${deploy.remote.host}:${deploy.remote.path}" />

    <exec command="rsync ${deploy.sync.options} ${deploy.sync.local} ${deploy.sync.remote}"
          passthru="true"
          logoutput="true"
          checkreturn="true" />
  </target>

</project>
